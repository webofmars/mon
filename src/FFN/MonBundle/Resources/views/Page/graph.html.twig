{% extends 'FFNMonBundle::layout.html.twig' %}

{% block metarefresh %}
<meta http-equiv="refresh" content="30">
{% endblock %}
    
{% block body %}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
{% autoescape('js') %}
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
            ['Time', 'DNS',  'TCP conn.',  '1st packet', 'Total time'],
            {% for row in graphdata %}
                [ 
                    {{ row.dateExecuted | date('H:i:s') | json_encode() | replace( {'"': '\''} ) | raw() }}, 
                    {{ row.dns | json_encode() | replace( {'"': ''} ) | raw() }}, 
                    {{ row.tcp | json_encode() | replace( {'"': ''} ) | raw() }},
                    {{ row.firstPacket | json_encode() | replace( {'"': ''} ) | raw() }},
                    {{ row.total | json_encode() | replace( {'"': ''} ) | raw() }}
                ],
            {% endfor %}
        ]   
    );

    var options = {
      //title: 'URL response time',
      hAxis: {title: 'Time',  titleTextStyle: {color: 'red'}},
      isStacked: true
    };

    var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
    chart.draw(data, options);
  }
</script>
{% endautoescape %}

{# google chart #}
<div class="container">
    <h2>{{ "mon_graph_label" | trans() | raw() }} {{ title }}</h2>
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
</div>

{# Data table #}
<div class="container">
    <i class="icon-hdd"></i> <h2>{{ 'Table' | trans() | raw() }}</h2>
<div class="row">
    <table class="table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th>{{ 'Execution Time' | trans() | raw() }}</th>
                <th>{{ 'DNS' | trans() | raw() }}</th>
                <th>{{ 'Tcp Connexion' | trans() | raw() }}</th>
                <th>{{ '1st Packet' | trans() | raw() }}</th>
                <th>{{ 'Total Time' | trans() | raw() }}</th>
            </tr>
        </thead>
        {% for row in graphdata %}
            <tr>
                <td>{{ row.dateExecuted.format('H:i:s') }}</td>
                <td>{{ row.dns }}</td>
                <td>{{ row.tcp }}</td>
                <td>{{ row.firstPacket }}</td>
                <td>{{ row.total }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
</div>
{% endblock %}